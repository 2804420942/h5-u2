"use strict";(self["webpackChunkh5_u2"]=self["webpackChunkh5_u2"]||[]).push([[473],{8859:function(e,t,a){var l=a(4311),n=a(6629);const r={baseURL:location.origin,timeout:5e3},u=l.Z.create(r);u.interceptors.request.use((function(e){return"get"===e.method&&"/api/login"!==e.url&&(localStorage.getItem("os-token")?(e.params||(e.params={}),Object.assign(e.params,{token:localStorage.getItem("os-token")})):((0,n.z8)({message:"请先登录",type:"warning"}),localStorage.clear())),e}),(function(e){return Promise.reject(e)})),u.interceptors.response.use((function(e){return 1===e.data.ret&&(0,n.z8)({message:"请先登录",type:"warning"}),e.data}),(function(e){return Promise.reject(e)})),t["Z"]=u},2648:function(e,t,a){a.d(t,{Gh:function(){return i},WU:function(){return n},XF:function(){return r},ax:function(){return u},c$:function(){return l},w6:function(){return s}});a(7658);function l(e=0,t=new Date,a=new Date){t.setDate(t.getDate()-e),a.setDate(a.getDate()+e);var l=[],n=[],r=["日","一","二","三","四","五","六"],u=0;while(a.getTime()-t.getTime()>=0){u++;var o=1==(t.getMonth()+1).toString().length?"0"+(t.getMonth()+1).toString():t.getMonth()+1,i=1==t.getDate().toString().length?"0"+t.getDate():t.getDate(),s=r[t.getDay()];n.push(o+"月"+i+"日（周"+s+"）");var c={};c.week=1==u?"今天":"周"+s,c.date=(new Date).getFullYear()+"-"+o+"-"+i,c.date2=o+"-"+i,l.push(c),t.setDate(t.getDate()+1)}return l}function n(e){return e.map((e=>({title:e.date.slice(5),dataKey:e.date,key:e.date,width:60})))}function r(e,t){var a=new Array,l=0;while(e<=t){a[l]=e;var n=new Date(e).getTime(),r=n+864e5,u=new Date(r).getFullYear()+"-",o=new Date(r).getMonth()+1<10?"0"+(new Date(r).getMonth()+1)+"-":new Date(r).getMonth()+1+"-",i=new Date(r).getDate()<10?"0"+new Date(r).getDate():new Date(r).getDate();e=u+o+i,l++}return a[0]=a[0].slice(0,10),a}function u(e){return o(e)}function o(e){var t=new Date;t.setDate(t.getDate()-e);var a=t.getFullYear(),l=t.getMonth()+1,n=t.getDate(),r=t.getHours(),u=t.getMinutes(),o=t.getSeconds();return[a,"-",l<10?`0${l}`:l,"-",n<10?`0${n}`:n," ",r<10?`0${r}`:r,":",u<10?`0${u}`:u,":",o<10?`0${o}`:o].join("")}function i(e){return new Function("return "+e)()}function s(e){let[t,a]=e.split("-");t=parseInt(t),a=parseInt(a);let l=a-t+1,n=t-1;return Array.apply(null,{length:l}).map(((e,t)=>(n++,n)))}},4527:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});a(7658);var l=a(3396),n=a(4870),r=a(7139),u=a(2648),o=a(319),i=a(6629),s=a(8859);const c={class:"activityTable"};var v={__name:"activityTable",setup(e){const t=(0,n.iH)([]);let a=(0,n.iH)(7);const v=(0,n.iH)([]);let m=(0,n.iH)((0,u.ax)(a.value));const d=(0,n.iH)(null);async function p(e){try{let{data:e=[]}=await s.Z.get("/api/select_activity",{params:{beginTime:m.value}}),t=[];e=e.filter((e=>{const t=Math.abs(Math.floor(((new Date).getTime()-new Date(e.startTime).getTime())/864e5)),l=Math.abs(Math.floor((new Date(e.endTime).getTime()-(new Date).getTime())/864e5));if(t<=a.value||l<=a.value)return!0})),e.forEach(((e,a)=>{t[a]=(0,u.XF)(e.startTime,e.endTime)})),e.forEach(((e,a)=>{g.value.forEach((l=>{t[a].includes(l.key)&&(e[l.key]=`${e.activityName}(${e.activityId})(${e.activityType})`)}))})),await(0,l.Y3)(),I=[],v.value=e}catch(t){(0,i.z8)({message:t,type:"warning"})}}(0,l.bv)((async()=>{await p(),w.value="10",t.value=v.value})),(0,l.YP)(a,(async e=>{m.value=(0,u.ax)(e),await p(),setTimeout((()=>{""==w.value&&(t.value=v.value),"70-80"==w.value?t.value=v.value.filter((e=>e.realmId.toString().startsWith("70")||e.realmId.toString().startsWith("80"))):t.value=v.value.filter((e=>e.realmId.toString().startsWith(w.value))),h.value.includes("-1")||(t.value=t.value.filter((e=>h.value.includes(e.activityType.toString())||h.value.includes("0-1-2")&&["0","1","2"].includes(e.activityType.toString())))),d.value.scrollTo({scrollLeft:0,scrollTop:0})}),0)}));const g=(0,l.Fl)((()=>[...x.value.slice(0,1),...x.value.slice(61-a.value,61+a.value)])),f=[{title:"服务器",key:"realmName",dataKey:"realmName",width:100},...(0,u.WU)((0,u.c$)(60))],w=(0,n.iH)("");(0,l.YP)(w,(e=>{t.value=""==e?v.value:"70-80"==e?v.value.filter((e=>e.realmId.toString().startsWith("70")||e.realmId.toString().startsWith("80"))):v.value.filter((t=>t.realmId.toString().startsWith(e))),h.value.includes("-1")||(t.value=t.value.filter((e=>h.value.includes(e.activityType.toString())||h.value.includes("0-1-2")&&["0","1","2"].includes(e.activityType.toString())))),I=[],d.value.scrollTo({scrollLeft:0,scrollTop:0})}));const h=(0,n.iH)(["-1"]);(0,l.YP)(h,(e=>{""==w.value?t.value=v.value:"70-80"==w.value?t.value=v.value.filter((e=>e.realmId.toString().startsWith("70")||e.realmId.toString().startsWith("80"))):t.value=v.value.filter((e=>e.realmId.toString().startsWith(w.value))),e.includes("-1")||(t.value=t.value.filter((t=>e.includes(t.activityType.toString())||e.includes("0-1-2")&&["0","1","2"].includes(t.activityType.toString())))),I=[],d.value.scrollTo({scrollLeft:0,scrollTop:0})}));const y=e=>{e.some((e=>"-1"!==e))&&"-1"!=e[e.length-1]?h.value=h.value.filter((e=>"-1"!==e)):h.value=["-1"]},b=(0,n.iH)(""),W=()=>{if(b.value){const e=b.value.split("#");let a=[];e.forEach((e=>{a.push((0,u.w6)(e))})),t.value=v.value.filter((e=>a.some((t=>t.includes(e.realmId)))))}else w.value=""},D=({rowData:e,columns:t})=>{const a=Object.keys(e);let l=1;for(let r=1;r<t.length-1;r++)t[r].dataKey===a[7]&&(l=r);const n=a.slice(7).length;return f[l].colSpan=()=>n,f[l].align="center",{colSpan:n,colSpanIndex:l}},T=0;f[T].rowSpan=({rowData:e,rowIndex:a})=>{let l=1;const n="realmName";if(a>0&&e[n]===t.value[a-1][n])return 0;for(let r=a+1;r<t.value.length;r++)e[n]===t.value[r][n]&&l++;return l},f[T].fixed=!0,f[T].sortable=!0;const S=(0,n.iH)({key:"realmName",order:o.As.ASC}),k=e=>{t.value=t.value.reverse(),S.value=e};let I=[];const x=(0,n.iH)(f),_=({rowData:e,rowIndex:a,cells:n,columns:r})=>{const{colSpanIndex:u,colSpan:o}=D({rowData:e,rowIndex:a,cells:n,columns:r}),i=r[T].rowSpan({rowData:e,rowIndex:a});let s=!1;for(let l=a;l<a+i;l++)for(let n=l+1;n<a+i;n++)if(e.activityType==t.value[n].activityType){let[a,r]=[new Date(e.startTime),new Date(t.value[n].startTime)],[u,o]=[new Date(e.endTime),new Date(t.value[n].endTime)];u<r||o<a||I.push([l,n])}if(o>=1&&n[u]&&n[u].props){let e=Number.parseInt(n[u].props.style.width);for(let a=1;a<o;a++)e+=Number.parseInt(n[u+a].props.style.width),n[u+a]=null;const t={...n[u].props.style,width:`${e}px`,justifyContent:"center",backgroundColor:"var(--el-color-primary-light-3)"};for(let l=0;l<I.length;l++)I[l].includes(a)&&(t.backgroundColor="var(--el-color-danger)");n[u]=(0,l.Ho)(n[u],{style:t})}if(i>=1){const r=n[T],u={...r.props.style,backgroundColor:"var(--el-color-primary-light-8)",height:30*i+"px",alignSelf:"flex-start",border:"1px solid var(--el-text-color-placeholder)",zIndex:1};for(let l=1;l<i;l++)if(e.activityType==t.value[a+l].activityType){let[n,r]=[new Date(e.startTime),new Date(t.value[a+l].startTime)],[u,o]=[new Date(e.endTime),new Date(t.value[a+1].endTime)];u<r||o<n||(s=!0)}s&&(u.backgroundColor="var(--el-color-danger)"),n[T]=(0,l.Ho)(r,{style:u})}return n};return(e,u)=>{const o=(0,l.up)("el-input"),i=(0,l.up)("el-button"),s=(0,l.up)("el-tooltip"),v=(0,l.up)("el-option"),m=(0,l.up)("el-select"),p=(0,l.up)("el-col"),f=(0,l.up)("el-row"),D=(0,l.up)("el-table-v2");return(0,l.wg)(),(0,l.iD)("div",c,[(0,l.Wm)(f,{style:{"margin-bottom":"20px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{span:8},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{modelValue:w.value,"onUpdate:modelValue":u[1]||(u[1]=e=>w.value=e),style:{width:"400px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{disabled:"",value:"#"},{default:(0,l.w5)((()=>[(0,l.Wm)(o,{placeholder:"请输入自定义服务器",modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=e=>b.value=e),style:{width:"270px","margin-right":"10px"}},null,8,["modelValue"]),(0,l.Wm)(i,{type:"primary",onClick:W},{default:(0,l.w5)((()=>[(0,l.Uk)("搜索")])),_:1}),(0,l.Wm)(s,{class:"box-item",effect:"dark",content:"请输入自定义服务器如：301001-301020,多条用#号分割",placement:"right"},{default:(0,l.w5)((()=>[(0,l.Uk)(" ❔ ")])),_:1})])),_:1}),(0,l.Wm)(v,{value:"",label:"选择全部"}),(0,l.Wm)(v,{value:"10",label:"美服"},{default:(0,l.w5)((()=>[(0,l.Uk)("美服")])),_:1}),(0,l.Wm)(v,{value:"70-80",label:"亚服"},{default:(0,l.w5)((()=>[(0,l.Uk)("亚服")])),_:1}),(0,l.Wm)(v,{value:"20",label:"欧服"},{default:(0,l.w5)((()=>[(0,l.Uk)("欧服")])),_:1}),(0,l.Wm)(v,{value:"30",label:"东南亚服"},{default:(0,l.w5)((()=>[(0,l.Uk)("东南亚服")])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(p,{span:8},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{modelValue:(0,n.SU)(a),"onUpdate:modelValue":u[2]||(u[2]=e=>(0,n.dq)(a)?a.value=e:a=e),style:{width:"400px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{value:7,label:"最近一周"}),(0,l.Wm)(v,{value:15,label:"最近十五天"}),(0,l.Wm)(v,{value:30,label:"最近一个月"}),(0,l.Wm)(v,{value:60,label:"最近两个月"})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(p,{span:8},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{modelValue:h.value,"onUpdate:modelValue":u[3]||(u[3]=e=>h.value=e),style:{width:"400px"},multiple:"","collapse-tags":"",onChange:y},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{value:"-1",label:"选择全部"}),(0,l.Wm)(v,{value:"0-1-2",label:"累充累销开服积分活动"}),(0,l.Wm)(v,{value:"1",label:"开服积分"}),(0,l.Wm)(v,{value:"6",label:"UP池"}),(0,l.Wm)(v,{value:"7",label:"心愿池"}),(0,l.Wm)(v,{value:"12",label:"精英挑战赛"}),(0,l.Wm)(v,{value:"10000",label:"宾果翻牌"}),(0,l.Wm)(v,{value:"120000",label:"燃油提纯"}),(0,l.Wm)(v,{value:"20000",label:"单服双倍币"}),(0,l.Wm)(v,{value:"130000",label:"全服双倍币"}),(0,l.Wm)(v,{value:"30000",label:"星球竞技场胜场"}),(0,l.Wm)(v,{value:"40000",label:"7日连充"}),(0,l.Wm)(v,{value:"140000",label:"7日连充2"}),(0,l.Wm)(v,{value:"50000",label:"英雄成长"}),(0,l.Wm)(v,{value:"80000",label:"新翻牌"}),(0,l.Wm)(v,{value:"100000",label:"量子拟态机"}),(0,l.Wm)(v,{value:"110000",label:"战货系统"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(D,{ref_key:"tableV2",ref:d,columns:(0,n.SU)(g),data:t.value,"sort-by":S.value,width:1600,height:700,"row-height":30,cache:30,fixed:"","scrollbar-always-on":"",onColumnSort:k},{row:(0,l.w5)((e=>[(0,l.Wm)(_,(0,r.vs)((0,l.F4)(e)),null,16)])),_:1},8,["columns","data","sort-by"])])),_:1})])}}},m=a(89);const d=(0,m.Z)(v,[["__scopeId","data-v-204ddb0a"]]);var p=d}}]);
//# sourceMappingURL=activityTable.2fe0fdea.js.map