"use strict";(self["webpackChunkh5_u2"]=self["webpackChunkh5_u2"]||[]).push([[780],{8859:function(e,a,l){var t=l(4311),i=l(6629);const d={baseURL:location.origin,timeout:5e3},n=t.Z.create(d);n.interceptors.request.use((function(e){return"get"===e.method&&"/api/login"!==e.url&&(localStorage.getItem("os-token")?(e.params||(e.params={}),Object.assign(e.params,{token:localStorage.getItem("os-token")})):((0,i.z8)({message:"请先登录",type:"warning"}),localStorage.clear())),e}),(function(e){return Promise.reject(e)})),n.interceptors.response.use((function(e){return 1===e.data.ret&&(0,i.z8)({message:"请先登录",type:"warning"}),e.data}),(function(e){return Promise.reject(e)})),a["Z"]=n},2232:function(e,a,l){l.r(a),l.d(a,{default:function(){return T}});var t=l(3396),i=l(4870),d=l(7139),n=l(5102),m=l(6629),s=l(8363),u=l(5743),o=l.n(u),r=l(8859);const p=e=>((0,t.dD)("data-v-a98fe0c8"),e=e(),(0,t.Cn)(),e),c={class:"addRealm"},w={class:"card-header",style:{display:"flex","justify-content":"space-between"}},g=p((()=>(0,t._)("span",{style:{"font-size":"20px","vertical-align":"middle"}}," 可修改服务器 ",-1))),v={key:0},f={key:1};var b={__name:"addRealm",setup(e){const a=(0,i.iH)("add"),l=e=>{"edit"===e&&(u.list[0]={areaName:u.list[0].areaName,bigRealmId:b.value[y.value].bigRealmId.toString(),openTime:o().unix(b.value[y.value].openTime).toDate(),visibleTime:o().unix(b.value[y.value].visibleTime).toDate(),realmId:b.value[y.value].realmId}),"add"===e&&(u.list[0]={areaName:"",bigRealmId:"",openTime:o()().set("hour",5).set("minute",0).set("second",0).toDate(),visibleTime:"",realmId:""},b.value=[]),a.value=e},u=(0,i.qj)({list:[{areaName:"",bigRealmId:"",openTime:o()().set("hour",5).set("minute",0).set("second",0).toDate(),visibleTime:"",realmId:""}]}),p=(0,i.iH)([]),b=(0,i.iH)([]),y=(0,i.iH)(0),k=e=>{y.value+=e};let T=0;(0,t.YP)((()=>u.list),(async e=>{e.forEach((async(e,a)=>{if(e.areaName){const{data:l}=await r.Z.get("/api/select_recentRealm",{params:{areaName:e.areaName}});b.value=l,y.value=l.length-1,T=l[l.length-1].bigRealmId,p.value[a]=[];for(let e=0;e<2;e++)p.value[a][e]=(T+e).toString();e.bigRealmId&&!p.value[a].includes(e.bigRealmId)&&(e.bigRealmId="")}}))}),{deep:!0});(0,i.iH)(""),(0,i.iH)("");const _=e=>e.getTime()<Date.now()-864e5||e.getTime()>Date.now()+1728e5,h=(0,t.Fl)((()=>u.list.map((e=>!!e.openTime)))),x=(e,a)=>!h.value[a]||e.getTime()<=u.list[a].openTime.getTime()-864e5,I=e=>u.list.some((a=>a.bigRealmId==e)),U=((0,i.iH)(null),async(e,a="add")=>{const l=j(e,"edit"===a||"del"===a)[0],t=W(l);t||(l.openTime&&l.openTime<Math.floor((new Date).getTime()/1e3)?m.z8.warning("服务器开服时间需大于当前时间！"):l.openTime&&l.visibleTime&&l.openTime>l.visibleTime?m.z8.warning("服务器对外时间需大于开服时间！"):s.T.confirm("确认要操作服务器吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await r.Z.post(`/api/add_realmInfo?account=${localStorage.getItem("account")}`,{simpleRealm:l,type:a,token:localStorage.getItem("os-token")});0===e.ret&&(m.z8.success(e.msg),setTimeout((()=>{location.reload()}),1e3)),1===e.ret&&m.z8.warning("操作失败！")})).catch((()=>{})))}),W=e=>Object.entries(e).some((([e,a])=>D(e,a))),R={areaName:"服务器大区",bigRealmId:"bigRealmId",openTime:"开服时间",visibleTime:"对外时间",realmId:"realmId"},D=(e,a)=>{if(0!==a&&"realmId"!==e&&!a)return m.z8.warning(`${R[e]}不能为空`),!0},j=(e,a)=>{const l=e.map((e=>(e.openTimeTmp=V(e.openTime,!0),e.visibleTimeTmp=V(e.visibleTime,!1),e)));return l.map((e=>({areaName:e.areaName,bigRealmId:parseInt(e.bigRealmId),openTime:e.openTimeTmp,visibleTime:e.visibleTimeTmp,realmId:a?e.realmId:void 0})))},V=(e,a)=>a?o()(e).set("hour",5).set("minute",0).set("second",0).unix():o()(e).unix(),q=async()=>{s.T.confirm("确认要提交吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await r.Z.get(`/api/commit_realmInfo?account=${localStorage.getItem("account")}`);0===e.code?m.z8.success("提交成功"):m.z8.warning(e.msg)})).catch((()=>{}))};return(e,m)=>{const s=(0,t.up)("el-option"),r=(0,t.up)("el-select"),T=(0,t.up)("el-form-item"),h=(0,t.up)("el-col"),W=(0,t.up)("el-button"),R=(0,t.up)("el-card"),D=(0,t.up)("el-date-picker"),j=(0,t.up)("el-space"),V=(0,t.up)("el-form"),N=(0,t.up)("el-row");return(0,t.wg)(),(0,t.iD)("div",c,[(0,t.Wm)(N,{gutter:10},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(u.list,((e,u)=>((0,t.wg)(),(0,t.iD)("div",{key:u},[(0,t.Wm)(V,{model:e,"label-width":"100px"},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{direction:(0,i.SU)(n.X)?"vertical":"horizontal"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{span:8,xs:24,style:{width:"369px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"服务器大区",required:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.areaName,"onUpdate:modelValue":a=>e.areaName=a,style:{width:"275px"},placeholder:"选择服务器大区"},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{value:"NA",label:"NA"},{default:(0,t.w5)((()=>[(0,t.Uk)("NA")])),_:1}),(0,t.Wm)(s,{value:"EU",label:"EU"},{default:(0,t.w5)((()=>[(0,t.Uk)("EU")])),_:1}),(0,t.Wm)(s,{value:"Asia",label:"Asia"},{default:(0,t.w5)((()=>[(0,t.Uk)("Asia")])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024),b.value.length>0&&"select"===a.value?((0,t.wg)(),(0,t.j4)(R,{key:0,class:"box-card"},{header:(0,t.w5)((()=>[(0,t._)("div",w,[(0,t.Wm)(W,{type:"primary",link:"",onClick:m[0]||(m[0]=e=>k(-1)),disabled:0===y.value},{default:(0,t.w5)((()=>[(0,t.Uk)("上一个")])),_:1},8,["disabled"]),g,(0,t.Wm)(W,{type:"primary",link:"",onClick:m[1]||(m[1]=e=>k(1)),disabled:y.value===b.value.length-1},{default:(0,t.w5)((()=>[(0,t.Uk)("下一个")])),_:1},8,["disabled"])])])),default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.value[y.value],((e,a)=>((0,t.wg)(),(0,t.iD)("div",{key:a,class:"text"},["openTime"==a||"visibleTime"==a?((0,t.wg)(),(0,t.iD)("div",v,(0,d.zw)(a+": "+(0,i.SU)(o()).unix(e).format("YYYY-MM-DD HH:mm:ss")),1)):((0,t.wg)(),(0,t.iD)("div",f,(0,d.zw)(a+": "+e),1))])))),128)),(0,t.Wm)(W,{type:"primary",link:"",onClick:m[2]||(m[2]=e=>l("edit"))},{default:(0,t.w5)((()=>[(0,t.Uk)("编辑")])),_:1})])),_:2},1024)):(0,t.kq)("",!0),"edit"===a.value||"add"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:1,span:8,xs:24,class:"tags",style:{width:"369px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"bigRealmId",required:""},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:e.bigRealmId,"onUpdate:modelValue":a=>e.bigRealmId=a,style:{width:"259px"},placeholder:"选择bigRealmId"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(p.value[u],(e=>((0,t.wg)(),(0,t.j4)(s,{key:e,value:e,label:e,disabled:I(e)},null,8,["value","label","disabled"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)):(0,t.kq)("",!0),"edit"===a.value||"add"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:2,span:8,xs:24,style:{width:"369px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"开服时间",required:""},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{style:{width:"275px"},modelValue:e.openTime,"onUpdate:modelValue":a=>e.openTime=a,type:"date","disabled-date":_,placeholder:"请选择开服时间"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)):(0,t.kq)("",!0),"edit"===a.value||"add"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:3,span:8,xs:24,style:{width:"369px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{label:"对外时间",required:""},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{style:{width:"275px"},modelValue:e.visibleTime,"onUpdate:modelValue":a=>e.visibleTime=a,type:"datetime","disabled-date":e=>x(e,u),placeholder:"请选择对外时间"},null,8,["modelValue","onUpdate:modelValue","disabled-date"])])),_:2},1024)])),_:2},1024)):(0,t.kq)("",!0)])),_:2},1032,["direction"])])),_:2},1032,["model"])])))),128)),"add"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:0,span:8,xs:24},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{style:{width:"350px"},type:"success",onClick:m[3]||(m[3]=e=>l("select"))},{default:(0,t.w5)((()=>[(0,t.Uk)("查看可修改服务器")])),_:1})])),_:1})):(0,t.kq)("",!0),"add"!==a.value?((0,t.wg)(),(0,t.j4)(h,{key:1,span:8,xs:24},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{style:{width:"350px"},type:"warning",onClick:m[4]||(m[4]=e=>l("add"))},{default:(0,t.w5)((()=>[(0,t.Uk)("返回新增")])),_:1})])),_:1})):(0,t.kq)("",!0),"edit"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:2,span:8,xs:24},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{style:{width:"350px"},type:"danger",onClick:m[5]||(m[5]=e=>U(u.list,"del")),plain:""},{default:(0,t.w5)((()=>[(0,t.Uk)("删除服务器")])),_:1})])),_:1})):(0,t.kq)("",!0),"add"===a.value||"edit"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:3,span:8,xs:24},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{style:{width:"350px"},type:"primary",onClick:m[6]||(m[6]=e=>U(u.list,"add"===a.value?"add":"edit")),plain:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,d.zw)("add"===a.value?"添加服务器":"修改服务器"),1)])),_:1})])),_:1})):(0,t.kq)("",!0),"add"===a.value||"edit"===a.value?((0,t.wg)(),(0,t.j4)(h,{key:4,span:8,xs:24},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{style:{width:"350px"},type:"primary",onClick:q},{default:(0,t.w5)((()=>[(0,t.Uk)("提交")])),_:1})])),_:1})):(0,t.kq)("",!0)])),_:1})])}}},y=l(89);const k=(0,y.Z)(b,[["__scopeId","data-v-a98fe0c8"]]);var T=k}}]);
//# sourceMappingURL=addRealm.0b923145.js.map